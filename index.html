<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Sniper PNCP - Painel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; font-size: 0.85rem; }
        .card-lic { border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: 0.2s; }
        .card-lic:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div id="loading" class="position-fixed w-100 h-100 bg-white d-flex flex-column align-items-center justify-content-center" style="z-index:9999">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2">Descompactando base de dados...</p>
    </div>

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid"><span class="navbar-brand">ðŸŽ¯ Sniper PNCP</span></div>
    </nav>

    <div class="container">
        <div class="card p-3 mb-4 shadow-sm">
            <div class="row g-2">
                <div class="col-md-3"><input type="text" id="fBusca" class="form-control" placeholder="Produto..."></div>
                <div class="col-md-2"><input type="text" id="fUF" class="form-control" placeholder="UF"></div>
                <div class="col-md-4"><input type="text" id="fOrgao" class="form-control" placeholder="Ã“rgÃ£o"></div>
                <div class="col-md-3"><button class="btn btn-primary w-100" onclick="render()">Filtrar</button></div>
            </div>
        </div>
        <div id="lista"></div>
    </div>

    <script>
        let DADOS = [];
        async function carregar() {
            const resp = await fetch('dados/oportunidades.json.gz');
            const ds = new DecompressionStream("gzip");
            const decompressed = (await resp.blob()).stream().pipeThrough(ds);
            DADOS = JSON.parse(await new Response(decompressed).text());
            document.getElementById('loading').remove();
            render();
        }

        function render() {
            const busca = document.getElementById('fBusca').value.toUpperCase();
            const uf = document.getElementById('fUF').value.toUpperCase();
            const container = document.getElementById('lista');
            container.innerHTML = '';

            DADOS.filter(l => {
                const matchBusca = !busca || l.objeto.toUpperCase().includes(busca) || l.itens.some(i => i.desc.toUpperCase().includes(busca));
                const matchUF = !uf || l.uf === uf;
                return matchBusca && matchUF;
            }).slice(0, 50).forEach(l => {
                container.innerHTML += `
                    <div class="card card-lic p-3 mb-3">
                        <div class="d-flex justify-content-between">
                            <strong>${l.uf} - ${l.orgao}</strong>
                            <span class="text-success fw-bold">R$ ${l.itens.reduce((a,b)=>a+b.total_est,0).toLocaleString('pt-BR')}</span>
                        </div>
                        <p class="text-muted small my-2">${l.objeto}</p>
                        <div class="d-flex gap-2">
                            <a href="${l.link}" target="_blank" class="btn btn-sm btn-outline-primary">Ver PNCP</a>
                            <button class="btn btn-sm btn-dark" onclick="alert('Itens: ${l.itens.length}')">Ver Detalhes</button>
                        </div>
                    </div>`;
            });
        }
        carregar();
    </script>
</body>
</html>
