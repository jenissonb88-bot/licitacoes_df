<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COLETA PNCP | Analista de Licitações</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

    <header class="bg-slate-900 text-white shadow-xl border-b-4 border-blue-600 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 p-2.5 rounded-xl shadow-inner">
                    <i class="fas fa-file-medical text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight leading-none uppercase">Analista de Licitações</h1>
                    <p class="text-[10px] text-blue-400 font-bold tracking-[0.3em] uppercase mt-1">Setor Saúde | PNCP 2026</p>
                </div>
            </div>
            <div id="status-sync" class="hidden md:block">
                <span class="text-[10px] bg-slate-800 text-slate-400 px-4 py-2 rounded-full border border-slate-700 font-mono">
                    <i class="fas fa-circle text-green-500 animate-pulse mr-2"></i>Sincronizado: 2026-01-01
                </span>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 lg:p-8">
        
        <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-end">
                
                <div class="md:col-span-2">
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 tracking-widest">Estado (UF)</label>
                    <select id="filtroUF" onchange="aplicarFiltros()" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                        <option value="">Brasil (Todos)</option>
                    </select>
                </div>

                <div class="md:col-span-6">
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 tracking-widest">Órgão, Cidade ou Medicamento</label>
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-4 text-slate-300"></i>
                        <input type="text" id="campoBusca" onkeyup="aplicarFiltros()" placeholder="Ex: Hospital Municipal, AAS, Soro..." class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    </div>
                </div>

                <div class="md:col-span-4 flex gap-3">
                    <button onclick="abrirModalManual()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition shadow-lg shadow-blue-100 flex items-center justify-center gap-2">
                        <i class="fas fa-plus-circle"></i> Inclusão Manual
                    </button>
                    <button onclick="location.reload()" class="bg-slate-100 hover:bg-slate-200 text-slate-500 p-3.5 rounded-xl border border-slate-200 transition">
                        <i class="fas fa-redo-alt"></i>
                    </button>
                </div>
            </div>
        </section>

        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 border-b border-slate-100">
                        <tr>
                            <th class="p-4 text-[10px] font-black text-slate-400 uppercase w-20">UF</th>
                            <th class="p-4 text-[10px] font-black text-slate-400 uppercase">Órgão / Edital</th>
                            <th class="p-4 text-[10px] font-black text-slate-400 uppercase">Objeto da Licitação</th>
                            <th class="p-4 text-[10px] font-black text-slate-400 uppercase text-center w-32">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaResultados" class="text-sm divide-y divide-slate-50">
                        <tr><td colspan="4" class="p-20 text-center text-slate-300 italic">Carregando oportunidades do PNCP...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="p-4 bg-slate-50 border-t border-slate-100 flex justify-between items-center">
                <span id="contadorItens" class="text-[11px] font-bold text-slate-400 uppercase italic tracking-wider">Total: 0 registros</span>
                <div class="flex gap-2 items-center">
                    <span class="text-[10px] font-bold text-slate-300 bg-white border border-slate-200 px-2 py-1 rounded">MODALIDADE: PREGÃO (6)</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        let dbOriginal = [];
        let dbFiltrado = [];

        // Inicialização dos Dados
        async function carregarDados() {
            try {
                const response = await fetch('dados/oportunidades.json');
                if (!response.ok) throw new Error("Arquivo não encontrado");
                dbOriginal = await response.json();
                
                // Popular UFs dinamicamente
                const ufs = [...new Set(dbOriginal.map(i => i.uf))].filter(Boolean).sort();
                const selectUF = document.getElementById('filtroUF');
                ufs.forEach(uf => selectUF.innerHTML += `<option value="${uf}">${uf}</option>`);

                aplicarFiltros();
            } catch (error) {
                document.getElementById('tabelaResultados').innerHTML = `
                    <tr><td colspan="4" class="p-20 text-center">
                        <i class="fas fa-exclamation-circle text-amber-500 text-3xl mb-4"></i><br>
                        <span class="text-slate-400 font-medium">Aguardando a primeira execução do robô de triagem (GitHub Actions).</span>
                    </td></tr>`;
            }
        }

        // Sistema de Filtragem
        function aplicarFiltros() {
            const uf = document.getElementById('filtroUF').value;
            const busca = document.getElementById('campoBusca').value.toLowerCase();

            dbFiltrado = dbOriginal.filter(item => {
                const matchUF = uf === "" || item.uf === uf;
                const matchBusca = item.orgao.toLowerCase().includes(busca) || item.objeto.toLowerCase().includes(busca);
                return matchUF && matchBusca;
            });

            renderizarTabela();
        }

        // Renderização da Interface
        function renderizarTabela() {
            const corpo = document.getElementById('tabelaResultados');
            const contador = document.getElementById('contadorItens');
            
            contador.innerText = `Total: ${dbFiltrado.length} registros encontrados`;

            if (dbFiltrado.length === 0) {
                corpo.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-slate-400 italic">Nenhum edital de saúde encontrado para estes filtros.</td></tr>';
                return;
            }

            corpo.innerHTML = dbFiltrado.map(item => `
                <tr class="hover:bg-blue-50/40 transition-colors duration-200">
                    <td class="p-4">
                        <span class="bg-blue-100 text-blue-700 font-black px-2.5 py-1.5 rounded-lg text-[10px] border border-blue-200 shadow-sm">${item.uf || 'BR'}</span>
                    </td>
                    <td class="p-4">
                        <div class="font-bold text-slate-800 uppercase text-[11px] truncate max-w-[240px] mb-1" title="${item.orgao}">${item.orgao}</div>
                        <div class="flex items-center gap-2">
                             <span class="text-[9px] bg-emerald-100 text-emerald-700 px-1.5 py-0.5 rounded font-black uppercase border border-emerald-200">Pregão (6)</span>
                             <span class="text-[9px] text-slate-300 font-mono">ID: ${item.numero}</span>
                        </div>
                    </td>
                    <td class="p-4 text-slate-500 text-[12px] leading-relaxed max-w-md truncate" title="${item.objeto}">
                        ${item.objeto}
                    </td>
                    <td class="p-4 text-center">
                        <div class="flex justify-center gap-2">
                            <a href="${item.link}" target="_blank" class="w-10 h-10 flex items-center justify-center bg-white border border-slate-200 text-blue-600 rounded-xl shadow-sm hover:bg-blue-600 hover:text-white transition-all transform hover:scale-110" title="Ver no PNCP">
                                <i class="fas fa-external-link-alt text-xs"></i>
                            </a>
                            <button onclick="excluirItem('${item.numero}')" class="w-10 h-10 flex items-center justify-center text-slate-200 hover:text-red-500 transition-colors" title="Descartar">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Inclusão Manual via PNCP
        function abrirModalManual() {
            const url = prompt("Cole o link direto do Edital no PNCP:");
            if (url && url.includes("pncp.gov.br")) {
                const partes = url.split('/');
                const seq = partes[partes.length - 1];
                
                const novoItem = {
                    uf: "M",
                    orgao: "INCLUSÃO MANUAL (PENDENTE)",
                    numero: seq || "EXTERN",
                    objeto: "Oportunidade adicionada manualmente para análise imediata.",
                    link: url
                };
                
                dbOriginal.unshift(novoItem);
                aplicarFiltros();
                alert("Licitação adicionada ao topo da lista!");
            } else if (url) {
                alert("Erro: O link deve ser do portal oficial pncp.gov.br");
            }
        }

        // Função de Excluir (Descartar)
        function excluirItem(numero) {
            if(confirm("Deseja remover esta oportunidade da visualização atual?")) {
                dbOriginal = dbOriginal.filter(i => i.numero !== numero);
                aplicarFiltros();
            }
        }

        // Início
        carregarDados();
    </script>
</body>
</html>
