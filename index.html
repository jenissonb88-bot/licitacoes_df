<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sniper PNCP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary-dark: #2c3e50; --accent-blue: #3498db; --danger-red: #e74c3c; --success-green: #27ae60; }
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; font-size: 0.85rem; }
        .header-bar { background: var(--primary-dark); color: white; padding: 12px 20px; }
        .card-table { background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 12px; padding: 15px; }
        .tarja { display: inline-block; padding: 2px 10px; border-radius: 4px; font-weight: 800; font-size: 0.65rem; color: white; text-transform: uppercase; margin-top: 5px; }
        .bg-exclusivo { background-color: var(--danger-red); }
        .bg-parcial { background-color: #e67e22; }
        .bg-amplo { background-color: var(--success-green); }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="loader"><div class="spinner-border text-primary"></div></div>
    <div class="header-bar d-flex justify-content-between">
        <div class="fw-bold">SNIPER PNCP</div>
        <div id="stats" class="small"></div>
    </div>
    <div class="container-fluid py-3">
        <div id="containerLicitacoes"></div>
        <div class="d-flex justify-content-between bg-white p-3 rounded shadow-sm mt-3">
            <div id="infoPagina" class="small fw-bold"></div>
            <div class="input-group input-group-sm" style="width: 150px;">
                <button class="btn btn-outline-dark" onclick="mudarPagina(-1)">Ant.</button>
                <input type="number" id="inputPulo" class="form-control text-center" placeholder="Pág">
                <button class="btn btn-dark" onclick="pularPagina()">Ir</button>
                <button class="btn btn-outline-dark" onclick="mudarPagina(1)">Próx.</button>
            </div>
        </div>
    </div>
    <script>
        let dadosLicitacoes = [], pagina = 1, itensPorPagina = 20;
        async function carregar() {
            const resp = await fetch(`dados/oportunidades.json.gz?t=${Date.now()}`);
            const ds = new DecompressionStream("gzip");
            const texto = await new Response(resp.body.pipeThrough(ds)).text();
            dadosLicitacoes = JSON.parse(texto);
            document.getElementById('loader').style.display = 'none';
            render();
        }
        function render() {
            const container = document.getElementById('containerLicitacoes');
            const exibidos = dadosLicitacoes.slice((pagina-1)*itensPorPagina, pagina*itensPorPagina);
            container.innerHTML = '';
            exibidos.forEach(l => {
                const total = l.itens.reduce((acc, i) => acc + (i.total_est || 0), 0);
                container.innerHTML += `
                    <div class="card card-table">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="small text-muted">Edital Nº</div>
                                <div class="text-primary fw-bold">${l.id.substring(14)}</div>
                                <span class="tarja ${l.tarja=='EXCLUSIVO'?'bg-exclusivo':(l.tarja=='PARCIAL'?'bg-parcial':'bg-amplo')}">${l.tarja}</span>
                            </div>
                            <div class="col-md-5 border-start ps-3">
                                <div class="fw-bold">${l.orgao}</div>
                                <div class="small text-muted">${l.cidade} / ${l.uf}</div>
                            </div>
                            <div class="col-md-3 border-start text-end">
                                <div class="fw-bold text-success">${total<=0?'SIGILOSO':'R$ '+total.toLocaleString('pt-BR')}</div>
                                <div class="small text-muted">${l.data_enc ? new Date(l.data_enc).toLocaleDateString():'---'}</div>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm btn-dark" onclick="alert('Ver detalhes no modal...')">DETALHES</button>
                            </div>
                        </div>
                    </div>`;
            });
            document.getElementById('infoPagina').innerText = `Pág ${pagina} de ${Math.ceil(dadosLicitacoes.length/itensPorPagina)}`;
        }
        function mudarPagina(d){ pagina+=d; render(); }
        function pularPagina(){ pagina=parseInt(document.getElementById('inputPulo').value); render(); }
        window.onload = carregar;
    </script>
</body>
</html>
