name: Sniper Pharma Inteligente
on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'
    - cron: '0 5 1,16 * *'

jobs:
  run-bot:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
      id-token: write
    steps:
    - uses: actions/checkout@v4
      with:
        persist-credentials: true
        fetch-depth: 0

    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: ðŸ“¦ INSTALL PACKAGES **PRIMEIRO**
      run: |
        pip install requests pandas openpyxl unicodedata2

    - name: ðŸŽ¯ SNIPER CAPTURA
      run: python app.py

    - name: ðŸ§¹ LIMPEZA
      run: python limpeza.py

    - name: ðŸ“Š CHECK DOMINÃ“
      id: domino
      run: |
        DIA=$(date +%d)
        if [ "$DIA" = "01" ] || [ "$DIA" = "16" ]; then
          echo "domino=true" >> $GITHUB_OUTPUT
        else
          echo "domino=false" >> $GITHUB_OUTPUT
        fi

    - name: ðŸ’¾ COMMIT
      run: |
        git config --global user.name "Sniper Pharma"
        git config --global user.email "bot@sniper.pharma"
        git add .
        if ! git diff --staged --quiet; then
          git commit -m "ðŸ¤– $(date +%Y-%m-%d)"
          git push
        fi

    - name: ðŸ”„ DOMINÃ“
      if: steps.domino.outputs.domino == 'true'
      run: gh workflow run sync-data.yml
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
